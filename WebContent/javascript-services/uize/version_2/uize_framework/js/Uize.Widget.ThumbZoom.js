/*
	UIZE JAVASCRIPT FRAMEWORK 2010-01-24

	http://www.uize.com/reference/Uize.Widget.ThumbZoom.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Widget.ThumbZoom',required:['Uize.Widget.ImagePort','Uize.Widget.Drag','Uize.Node','Uize.Fade'],builder:function(c_a){var c_b=true,c_c=false,c_d=Uize.Node,c_e=Uize.Widget,c_f=document.documentElement;var c_g;var c_h=c_a.subclass(function(){var c_i=this;c_i.showFade=new Uize.Fade({duration:350,acceleration:1,deceleration:0,quantization:1});c_i.hideFade=new Uize.Fade({duration:250,acceleration:0,deceleration:1,startValue:1,endValue:0});c_i.shieldFade=new Uize.Fade({duration:3000,acceleration:1,deceleration:0,startValue:0,endValue:1});},function(){var c_i=this;if(c_i.c_j)c_i.c_k=c_i.addChild('loadingProgress',c_e.Bar.Progress);}),c_l=c_h.prototype;c_l.wireUi=function(){var c_i=this;if(!c_i.isWired){if(c_i.c_j&& !c_i.c_k.getNode()){c_i.c_k.insertUi();c_i.c_k.setNodeStyle('',{position:'absolute'});}var c_m,c_n,c_o=c_i.showFade,c_p=c_i.hideFade,c_q=c_i.shieldFade;function c_r(){if(!c_n){c_n=document.createElement('img');c_d.setStyle(c_n,{display:'none',position:'absolute',zIndex:50001});
c_i.wireNode(c_n,'load',function(c_s){c_i.c_j&&c_i.c_k.set({inProgress:c_c});c_d.display(c_n);c_d.setOpacity(c_n,1);var c_t=c_d.getCoords(c_m),c_u=c_d.getDimensions(window),c_v=c_e.ImagePort.getScaledRect({portWidth:c_u.width,portHeight:c_u.height,rectWidth:c_n.width,rectHeight:c_n.height,alignX:.5,alignY:.5,sizingLowerBound:0,sizingUpperBound:'fit',sizingValue:.95,maxScaling:1});c_v.left+=c_f.scrollLeft;c_v.top+=c_f.scrollTop;var c_w=document.onkeydown,c_x=document.onmousemove,c_y=document.onmousedown,c_z=c_s.clientX,c_A=c_s.clientY;function c_B(){c_o.stop();document.onmousemove=c_x;document.onmousedown=c_y;document.onkeydown=c_w;c_q.stop();c_d.display(c_g,c_c);c_p.start();return c_c;}document.onkeydown=document.onmousedown=c_B;document.onmousemove=function(c_s){c_s=c_s||event;return(c_s.clientX!=c_z||c_s.clientY!=c_A?c_B():c_c);};function c_C(c_t){return{left:c_t.left,top:c_t.top,width:c_t.width,height:c_t.height};}c_o.start({startValue:c_C(c_t),endValue:c_C(c_v)});});document.body.appendChild(c_n);if(!c_g)
c_g=c_e.Drag.insertShield({zIndex:50000,backgroundColor:'#000'});c_o.wire({'Changed.value':function(){c_d.setStyle(c_n,c_o.valueOf());},Done:function(){c_d.setOpacity(c_g,0);c_d.display(c_g);c_q.start();}});c_p.wire({'Changed.value':function(){c_d.setOpacity(c_n,c_p);},Done:function(){c_d.display(c_n,c_c);}});c_q.wire({'Changed.value':function(){c_d.setOpacity(c_g,c_q);}});}}function c_D(){c_m=this;var c_E=c_c,c_F=c_m;while(c_F&&c_F.tagName!='A')c_F=c_F.parentNode;if(c_F){var c_G=c_F.getAttribute('href');if((c_i.c_H||/./).test(c_G)){c_r();if(c_i.c_j){var c_t=c_d.getCoords(c_m);c_i.c_k.setNodeStyle('',{left:c_t.x+3,top:c_t.y+c_t.height-1-c_i.c_k.getNode().offsetHeight-3});c_i.c_k.set({inProgress:c_b});}c_d.setStyle(c_n,{width:'',height:'',left:-10000,top:-10000});c_n.src=c_F.href;c_E=c_b;}}return!c_E;}c_d.doForAll(c_d.find(c_i.c_I),function(c_J){c_J.onclick=c_d.returnFalse;c_i.wireNode(c_J,'click',c_D);});}};c_h.registerProperties({c_H:{name:'imageValidator',value:/\.(jpg|jpeg|gif|png)/},c_j:{
name:'showLoadingProgress',value:c_c},c_I:{name:'thumbNodes',value:[]}});return c_h;}});