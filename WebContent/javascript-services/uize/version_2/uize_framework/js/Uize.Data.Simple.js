/*
	UIZE JAVASCRIPT FRAMEWORK 2010-01-24

	http://www.uize.com/reference/Uize.Data.Simple.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Data.Simple',required:'Uize.String.Lines',builder:function(){var _a,_b='string',_c=function(){};var _d=_c.getIndentationLevel=function(_e){return _e.length-_e.replace(/^\s*/,'').length;};_c.parse=function(_f){var _g=_f.simple,_h=_f.parseName!==false,_i=/^(\.{2,}|,{2,}|~{2,}|`{2,}|:{2,})$/,_j=/^\s*#(\(+|\)+|<+|>+|\[+|\]+|\{+|\}+)$/,_k={'<':'>','>':'<','(':')',')':'(','[':']',']':'[','{':'}','}':'{'},_l={name:'',value:'',children:[]},_m=Uize.String.Lines.split(_g),_n=_m.length,_o=_n-1,_p,_e,_q=0,_r={_s:_l,_t:0,_u:''},_v=[_r];function _w(){var _x=[],_y=_d(_e),_z= -1,_A;while(_p<_o){_p++;if(_A=_m[_p]){var _B=_d(_A);if(_z<0)_z=_B;if(_B<=_y){_p--;break;}else{_x.push(_A.slice(_z));}}else{_x.push('');}}_x.length&& !_x[_x.length-1]&&_x.pop();return _x;}for(_p= -1;++_p<_n;){if(_e=_m[_p]){if(_j.test(_e)){var _C=_e.charAt(_e.indexOf('#')+1);while(_p<_o){_p++;var _D=_m[_p];if(_D.length==_e.length&&_j.test(_D)&&_k[_C]==_D.charAt(_D.indexOf('#')+1))break;}}else if(/^\s*###/.test(_e)){_w();}else{var
 _E=_e.replace(/^\s*/,''),_t=_e.length-_E.length;if(_t!=_r._t){if(_t>_r._t){var _F=_r._s.children;_q++;_r=_v[_q]={_s:_F[_F.length-1],_t:_t};}else{while(_q&&_r._t>_t){_q--;_r=_v[_q];}}}var _F=_r._s.children,_G=_F.length,_H,_I;if(_h){var _J=_E.match(/^([^:]*[^:\s])?(?:\s*:\s*(.*))?$/);_H=_J[1]||'';_I=_J[2]||'';}else{_H='';_I=_E;}if(_h&& !_H&&_G){var _K=_F[_G-1];_H=_K.name;if(_H!=_r._u){_r._u=_H;!_K.value&& !_K.children.length&&_G--;}}if(_i.test(_I)){var _C=_I.charAt(0);_I='';while(_p<_o){_p++;_E=(_e=_m[_p]).slice(_t);if(_i.test(_E)&&_E.charAt(0)==_C){break;}else{_I+=_E+'\n';}}}else if(_I==':'){_I=_w().join('\n');}else if(_I=='>'){_I=_w();}else{var _L='\\s*\\|\\s*';if(_h&&_I.charAt(0)=='|'&&_I.slice(-1)=='|')_I=_I.replace(new RegExp('^'+_L),'').replace(new RegExp(_L+'$'),'').split(new RegExp(_L));}if(_h&& !_H){var _M=_r._s.value;if(typeof _M==_b)_r._s.value=_M?[_M]:[];_r._s.value.push(_I);}else{_F[_G]={name:_H,value:_I,children:[]};}}}}_f.collapseChildren&&_N(_l);return _l;};
var _N=_c.collapseChildren=function(_l,_O){var _P=_l.children;delete _l.name;delete _l.children;delete _l.value;if(_P){var _Q={},_R=0;for(var _S= -1,_T=_P.length;++_S<_T;){var _U=_P[_S],_V=_U.name||'',_W=_U.children&&_U.children.length?_U:_U.value;if(_W===_a)_W=_O;_N(_U,_O);if(_Q[_V]){if(_Q[_V]==1)_l[_V]=[_l[_V]];_l[_V].push(_W);_Q[_V]++;}else{_R++;_Q[_V]=1;_l[_V]=_W;}}if(_R==1&&_Q[''])_l=_Q['']==1?[_l['']]:_l[''];}return _l;};return _c;}});