/*
	UIZE JAVASCRIPT FRAMEWORK 2010-01-24

	http://www.uize.com/reference/Uize.Widget.Collection.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Widget.Collection',required:['Uize.Widget.Button','Uize.Node.Event'],builder:function(c_a){var c_b=true,c_c=false,c_d=null,c_e;var c_f=c_a.subclass(function(){var c_g=this;c_g.c_h=0;c_g.c_i=c_g.itemWidgets=[];c_g.wire('Items Changed',function(){c_g.set({c_j:c_g.c_i.length});c_g.c_k();});},function(){var c_g=this;c_g.c_l('selectAll',function(){c_g.selectAll()},{affectedBy:['allSelected','totalItems','selectionMode','isEmpty'],stateEvaluator:function(){return(!this.c_m&& !this.c_n&&(this.c_o!='single'||this.c_j==1))}});c_g.c_l('selectNone',function(){c_g.selectAll(c_c)},'someSelected');c_g.c_l('remove',function(){c_g.c_p(c_g.c_q(),c_b)},'someSelected');}),c_r=c_f.prototype;c_r.c_l=c_r.addControlButton=function(c_s,c_t,c_u){var c_g=this,c_v=Uize.Widget.Button.addChildButton.call(c_g,c_s,c_t);if(typeof c_u=='string'&&(c_u=c_u.replace(' ',''))){var c_w=c_u.replace('!',''),c_x=c_u.charAt(0)=='!';c_u={affectedBy:c_w,stateEvaluator:function(){return c_g.get(c_w)!=c_x}};}if(c_u){
var c_y=c_u.affectedBy;if(typeof c_y=='string')c_y=[c_y];function c_z(){c_v.set({enabled:c_u.stateEvaluator.call(c_g)?'inherit':c_c});}for(var c_A= -1,c_B=c_y.length;++c_A<c_B;)c_g.wire('Changed.'+c_y[c_A],c_z);c_z();};return c_v;};c_r.c_k=function(){this.set({c_C:this.c_q().length});};c_r.c_D=function(){this.isWired&&this.setNodeValue('totalItems',this.c_j);};c_r.c_p=function(c_E,c_F){var c_g=this,c_G=c_E.length;if(c_G){function c_H(){c_g.remove(c_E,c_F)}if(c_F){c_g.confirm({message:c_g.localize(c_G==1?'removeItemConfirmation':'removeItemsConfirmation',{0:c_G,itemsToRemove:c_E}),title:c_g.localize(c_G==1?'removeItemConfirmationTitle':'removeItemsConfirmationTitle',{0:c_G,itemsToRemove:c_E}),yesHandler:c_H});}else{c_H();}}};c_r.addItemWidget=function(c_I,c_J){var c_g=this,c_K=c_g.addChild(c_I,c_g.c_L,c_f.copyInto(c_J,c_g.getItemWidgetProperties()));c_K.wire({'Changed.selected':function(){if(c_K.get('selected')){c_g.c_o=='single'&&c_g.selectAll(c_c,c_g.c_M=c_K);c_g.fire({name:'Item Selected',itemWidget:c_K});
}else if(c_K==c_g.c_M)c_g.c_M=c_d;c_g.c_k();},'Click Selected':function(c_N){var c_O=c_N.domEvent,c_P=c_O&&c_O.shiftKey,c_Q=(!c_P&&c_N.forceToggle)||(c_O&&c_O.ctrlKey),c_R=c_Q||c_P;c_R&&Uize.Node.Event.abort(c_O);if((c_g.c_o=='single'&& !(c_Q&&c_K.get('selected')))|| !c_R){c_K.set({selected:c_b});c_g.selectAll(c_c,c_g.c_M=c_K);}else{c_P?c_g.selectRange(c_g.c_M,c_K):(c_g.c_M=c_K).toggle('selected');}},Remove:function(c_N){c_g.c_p(c_K.get('selected')&&c_g.c_S?c_g.c_q():[c_K],c_N.byUser);}});c_g.c_i.push(c_K);c_g.isWired&&c_K.insertOrWireUi();return c_K;};c_r.forAll=c_r.c_T=function(c_U){for(var c_V= -1,c_i=this.c_i,c_W=c_i.length;++c_V<c_W;){if(c_U(c_i[c_V],c_V)===c_c)break;}};c_r.getItemWidgetProperties=function(){return this.c_X};c_r.makeItemWidgetName=function(c_Y){var c_g=this;return((c_Y&&c_g.c_Z&&c_Y[c_g.c_Z])||(c_g.c_0+(c_g.c_i.length? ++c_g.c_h:c_g.c_h=0)));};c_r.getSelected=c_r.c_q=function(c_1){var c_2=[];this.c_T(function(c_K){c_K.get('selected')&&c_2.push(c_K)});
return!c_2.length&&c_1?this.c_i.concat():c_2;};c_r.getPropertyForItems=function(c_w,c_i){var c_3=[];for(var c_V= -1,c_W=c_i.length,c_4=c_w==c_e;++c_V<c_W;){var c_5=c_i[c_V].get('properties');c_3.push(c_4?c_5:c_5[c_w]);}return c_3;};c_r.getPropertyForSelected=function(c_w,c_1){return this.getPropertyForItems(c_w,this.c_q(c_1));};c_r.updateUi=function(){this.c_D();};c_r.remove=function(c_E,c_F){var c_g=this;function c_6(c_E,c_F){c_g.finishRemove(c_E,c_F);}c_g.fire({name:'Remove',itemWidgets:c_E,byUser:c_F,finishRemove:c_6}).handled||c_6(c_E,c_F);};c_r.finishRemove=function(c_E,c_F){};c_r.selectAll=function(c_2,c_7){if(!(c_2=c_2!==c_c)||this.c_o!='single'||this.c_j==1)this.c_T(function(c_K){c_K!==c_7&&c_K.set({selected:c_2});});};c_r.selectRange=function(c_8,c_9){var c_g=this;if(c_8&&c_9&&(c_g.c_o=='multi'||c_8==c_9)){var c_ba=c_c;c_g.c_T(function(c_K){var c_bb=c_K==c_8||c_K==c_9;if(c_bb)c_ba= !c_ba;c_K.set({selected:c_ba||c_bb});});}};c_r.selectNone=function(){this.selectAll(c_c)};c_f.registerProperties({c_m:{
name:'allSelected',value:c_c},c_n:{name:'isEmpty',value:c_b},c_Z:{name:'itemPropertyForItemWidgetName',value:'id'},c_S:{name:'itemRemoveActsOnSelection',value:c_c},c_bc:{name:'items',value:[],onChange:function(){var c_g=this;for(var c_bd= -1,c_bc=c_g.c_bc,c_be=c_bc.length;++c_bd<c_be;){var c_Y=c_bc[c_bd];c_g.addItemWidget(c_g.makeItemWidgetName(c_Y),{properties:c_Y});}c_g.fire('Items Changed');}},c_L:'itemWidgetClass',c_0:{name:'itemWidgetNamePrefix',value:'item'},c_X:'itemWidgetProperties',c_bf:{name:'oneSelected',value:c_c},c_o:{name:'selectionMode',value:'multi'},c_bg:{name:'someSelected',value:c_c},c_j:{name:'totalItems',onChange:function(){this.set({c_n:!this.c_j});this.c_D();}},c_C:{name:'totalSelected',value:0,onChange:function(){var c_g=this,c_C=c_g.c_C;c_g.set({c_bf:c_C==1,c_bg:c_C>0,c_m:c_C>0&&c_C==c_g.c_j});}}});return c_f;}});