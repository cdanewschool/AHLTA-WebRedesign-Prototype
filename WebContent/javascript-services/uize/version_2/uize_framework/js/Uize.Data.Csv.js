/*
	UIZE JAVASCRIPT FRAMEWORK 2010-01-24

	http://www.uize.com/reference/Uize.Data.Csv.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Data.Csv',required:'Uize.String',builder:function(){var _a=function(){},_b=true,_c=false,_d;var _e={columns:'all',hasHeader:false,trimPaddingOnParse:false,quoteChar:'"',rowType:'auto',valueDelimiter:',',whenToQuoteValues:'auto'};var _f={'\a':'a','\e':'e','\f':'f','\r':'r','\n':'n','\t':'t'};function _g(_h){return _h.replace(/[\a\e\f\r\n\t\^\$\|\.\?\*\+\,\:\[\]\(\)\{\}\\]/g,function(_i){return'\\'+(_f[_i]||_i)});}function _j(_k,_l){var _m=_k?_k[_l]:_d;return _m==_d?_e[_l]:_m;}function _n(_k){return Uize.String.repeat(_j(_k,'quoteChar'),2);}function _o(_p){return new RegExp(_g(_p),'g');}_a.from=function(_q,_r){var _s=_j(_r,'columns'),_t=_j(_r,'hasHeader'),_u=_j(_r,'trimPaddingOnParse'),_v=_j(_r,'quoteChar'),_w=_j(_r,'rowType'),_x=_j(_r,'valueDelimiter'),_y=_n(_r),_z=_o(_y),_A=Uize.isArray(_s),_B=_w=='object'||(_w=='auto'&&(_t||(_A&&_s.length))),_C=[],_D=0,_E=_t? -1:0,_F=0,_G=_q.length,_H=_G-1;_t&&(_A?(_s.length=0):(_s=[]));function _I(_J){(_E<0?_s:_C[_E]||(_C[_E]=_B?{}:[]))[
_B&&_E> -1?_s[_F]:_F]=_u?Uize.String.trim(_J):_J;_F++;}function _K(_L){var _M=_q.indexOf(_L,_D);return _M<0?_G:_M;}function _N(){return Math.min(_K('\n'),_K('\r'),_K(_x),_K(_v));}var _O,_P,_Q,_R,_S;while(_D<_G){_P=_q.charAt(_S=_O=_N());if(_P==_v){_Q=_R=_c;while(!_Q){_S=_q.indexOf(_v,_S+1);if(_S<0)_S=_G;_S<_H&&_q.charAt(_S+1)==_v?(_S+=(_R=_b)):(_Q=_b);}var _T=_q.slice(_O+1,_S);_I(_R?_T.replace(_z,_v):_T);_D=_S+1;_D=_N();_D+=_q.charAt(_D)==_x;}else if(_O==_D&&(_P=='\n'||_P=='\r')){_E++;_F=0;_D+=1+(_P=='\r'&&_D<_H&&_q.charAt(_D+1)=='\n');}else{_I(_q.slice(_D,_O));_D=_O+(_P==_x);}}return _C;};_a.to=function(_U,_V){var _W=[],_X=_U[0],_Y=_j(_V,'whenToQuoteValues')=='always',_s=_j(_V,'columns'),_t=_j(_V,'hasHeader'),_u=_j(_V,'trimPaddingOnParse'),_v=_j(_V,'quoteChar'),_w=_j(_V,'rowType'),_x=_j(_V,'valueDelimiter'),_Z=Uize.String.hasPadding(_x),_y=_n(_V),_0=_o(_v),_B=_w=='object'||(_w=='auto'&&_X&& !Uize.isArray(_X));if(_s=='all')_s= !_X?[]:_B?Uize.Data.getKeys(_X):Uize.Data.map('key',_X.length);var _1=_s.length;
for(var _E= -1-_t,_2=_U.length;++_E<_2;){var _3=_E<0?_s:_U[_E];for(var _F= -1;++_F<_1;){var _T=_3[_E<0|| !_B?_F:_s[_F]]+'',_4=_T.indexOf(_v)> -1,_5=_4||_Y||(_u?Uize.String.hasPadding(_T):_Z)||_T.indexOf(_x)> -1||_T.indexOf('\n')> -1||_T.indexOf('\r')> -1?_v:'';_W.push((_F?_x:'')+_5+(_4?_T.replace(_0,_y):_T)+_5);}_E<_2-1&&_W.push('\n');}return _W.join('');};return _a;}});