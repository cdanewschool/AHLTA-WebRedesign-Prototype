/*
	UIZE JAVASCRIPT FRAMEWORK 2010-01-24

	http://www.uize.com/reference/Uize.Widget.Committer.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Widget.Committer',required:'Uize.Widget.Button',builder:function(c_a){var c_b=null,c_c=true,c_d=false;var c_e=c_a.subclass(function(){var c_f=this;c_f.c_g;c_f.c_h=c_f.c_i('commit',function(){c_f.commit()});function c_j(c_k){var c_l=c_f.c_l,c_m=c_f.c_m,c_n=c_f.get(c_k+'Values');for(var c_o in c_m){var c_p=c_l[c_o],c_q={};c_q[c_p.name]=c_n?c_n[c_o]:'';c_p.instance.set(c_q);}}c_f.c_r=c_f.c_i('clearAll',function(){c_j('clear')});c_f.c_s=c_f.c_i('restoreInitial',function(){c_j('initial')});c_f.c_t=c_f.c_i('restorePrevious',function(){c_j('committed')});}),c_u=c_e.prototype;c_u.c_i=Uize.Widget.Button.addChildButton;c_u.c_v=function(){this.c_g&&clearTimeout(this.c_g);};c_u.c_w=function(){var c_f=this,c_x=c_c,c_y=c_c,c_z=c_d,c_A=c_d,c_m=c_f.c_m,c_B=c_f.c_B,c_C=c_f.c_C,c_l=c_f.c_l;for(var c_o in c_m){var c_D=c_B[c_o];if(!c_z&&c_D!==c_m[c_o])c_z=c_c;if(!c_A&&c_D!==c_C[c_o])c_A=c_c;if(c_y&&c_D!='')c_y=c_d;if(c_x&& !c_l[c_o].instance.get('isValid'))c_x=c_d;}c_f.set({c_y:c_y,c_x:c_x,c_z:c_z,
c_A:c_A,c_E:c_z&&c_x});};c_u.commit=function(){var c_f=this;c_f.c_v();if(c_f.c_E){c_f.set({c_m:c_e.copyInto({},c_f.c_B)});c_f.fire('Commit');c_f.c_w();}};c_e.registerProperties({c_y:{name:'allClear',onChange:function(){this.c_r.set({enabled:this.c_y?c_d:'inherit'});},value:c_d},c_x:{name:'allValid',value:c_d},c_A:{name:'anyNotInitial',onChange:function(){this.c_s.set({enabled:this.c_A?'inherit':c_d});},value:c_d},c_z:{name:'anyNotCommitted',onChange:function(){this.c_t.set({enabled:this.c_z?'inherit':c_d});},value:c_d},c_F:'autoCommitDelay',c_m:{name:'committedValues',value:{}},c_C:{name:'initialValues',value:{}},c_E:{name:'readyToCommit',onChange:function(){this.c_h.set({enabled:this.c_E?'inherit':c_d});},value:c_d},c_B:{name:'uncommittedValues',value:{}},c_l:{name:'watchedProperties',onChange:function(){var c_f=this,c_l=c_f.c_l,c_m={},c_B={},c_C={};if(c_l){function c_G(c_o,c_p){var c_H=c_p.instance,c_I=c_p.name;c_m[c_o]=c_B[c_o]=c_C[c_o]=c_H.get(c_I);c_H.wire('Changed.'+c_I,function(){c_f.c_B[c_o]=
c_H.get(c_I);c_f.c_w();if(c_f.c_E&&c_f.c_F){c_f.c_v();c_f.c_g=setTimeout(function(){c_f.commit()},c_f.c_F)}});}for(var c_o in c_l)c_G(c_o,c_l[c_o]);}c_f.set({c_m:c_m,c_C:c_C,c_B:c_B});c_f.c_w();}}});return c_e;}});