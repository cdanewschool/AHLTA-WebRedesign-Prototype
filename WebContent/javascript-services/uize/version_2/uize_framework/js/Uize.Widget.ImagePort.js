/*
	UIZE JAVASCRIPT FRAMEWORK 2010-01-24

	http://www.uize.com/reference/Uize.Widget.ImagePort.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Widget.ImagePort',required:'Uize.Node',builder:function(c_a){var c_b,c_c=true,c_d=false,c_e=Uize.Node;var c_f=c_a.subclass(),c_g=c_f.prototype;function c_h(c_i,c_j,c_k,c_l,c_m){if(typeof c_l!='number')c_l=parseFloat(c_l)||0;if(typeof c_m!='number')c_m=parseFloat(c_m)||1;c_i= +c_i+c_l*c_j;c_j*=(c_m-c_l);return c_j==c_k?.5:c_i/(c_k-c_j);}c_g.c_n=function(){var c_o=this;if(c_o.isWired){var c_p=c_o.c_p,c_q=c_o.getScaledRect(c_p);c_o.setNodeStyle('image',c_q);c_o.set({c_r: !!(c_o.portVsScaledDelta[0]=c_p.portWidth-c_q.width),c_s: !!(c_o.portVsScaledDelta[1]=c_p.portHeight-c_q.height)});}};c_g.updateUi=function(){var c_o=this;if(c_o.isWired){var c_t=c_e.getDimensions(c_o.getNode());if(!c_o.c_u){var c_v=c_e.getDimensions(c_o.getNode('image'));c_o.c_u=c_v.width;c_o.c_w=c_v.height;}c_o.c_p={portWidth:c_t.width,portHeight:c_t.height,rectWidth:c_o.c_u,rectHeight:c_o.c_w};Uize.Node.isIe&&c_o.setNodeStyle('image',{msInterpolationMode:'bicubic'});c_o.c_n();}};c_g.wireUi=function(){var c_o=this;
if(!c_o.isWired){c_o.setNodeStyle('',{overflow:'hidden'});c_o.setNodeStyle('image',{position:'absolute'});c_o.portVsScaledDelta=[];c_a.prototype.wireUi.call(c_o);}};c_g.getScaledRect=c_f.getScaledRect=function(c_x){function c_y(c_z){return c_z=='fit'?c_A:(c_z=='fill'?c_B:0);}function c_C(c_D){return c_x[c_D]!==c_b?c_x[c_D]:c_o.get(c_D);}var c_o=this,c_E=c_x.portWidth,c_F=c_x.portHeight,c_G=c_x.rectWidth,c_H=c_x.rectHeight,c_I=c_C('coordConverter'),c_J=c_E/c_G,c_K=c_F/c_H,c_A=Math.min(c_J,c_K),c_B=Math.max(c_J,c_K),c_L=c_y(c_C('sizingLowerBound')),c_M=c_y(c_C('sizingUpperBound')),c_N=Math.min(c_L+(c_M-c_L)*c_C('sizingValue'),c_C('maxScaling')),c_O=c_G*c_N,c_P=c_H*c_N;return{left:c_I((c_E-c_O)*c_C('alignX')),top:c_I((c_F-c_P)*c_C('alignY')),width:c_I(c_O),height:c_I(c_P)};};c_g.getSizingAndAlign=c_f.getSizingAndAlign=function(c_x){function c_Q(c_z){return c_z=='fit'?c_R:(c_z=='fill'?c_S:0);}function c_C(c_D){return c_x[c_D]!==c_b?c_x[c_D]:c_o.get(c_D);}var c_o=this,c_E=c_x.portWidth,c_F=c_x.portHeight,
c_G=c_x.rectWidth,c_H=c_x.rectHeight,c_T=c_G*c_H,c_J=c_E/c_G,c_K=c_F/c_H,c_A=Math.min(c_J,c_K),c_B=Math.max(c_J,c_K),c_R=c_A*c_A*c_T,c_S=c_B*c_B*c_T,c_U=c_Q(c_C('sizingLowerBound')),c_V=c_Q(c_C('sizingUpperBound'));return{sizingValue:Math.sqrt(c_T-c_U)/Math.sqrt(c_V-c_U),alignX:c_h(c_x.rectX,c_G,c_E),alignY:c_h(c_x.rectY,c_H,c_F)};};function c_W(){this.c_n();this.fire('Position Changed');}c_f.registerProperties({c_r:'alignApplicableX',c_s:'alignApplicableY',c_X:{name:'alignX',onChange:c_W,value:.5},c_Y:{name:'alignY',onChange:c_W,value:.5},c_I:{name:'coordConverter',value:function(c_Z){return c_Z}},c_0:{name:'maxScaling',onChange:c_W,value:Infinity},c_1:{name:'sizingLowerBound',onChange:c_W,value:'fit'},c_2:{name:'sizingUpperBound',onChange:c_W,value:'fill'},c_3:{name:'sizingValue',onChange:c_W,value:1}});return c_f;}});