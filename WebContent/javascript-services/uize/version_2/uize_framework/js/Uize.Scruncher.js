/*
	UIZE JAVASCRIPT FRAMEWORK 2010-01-24

	http://www.uize.com/reference/Uize.Scruncher.html
	Available under MIT License or GNU General Public License -- http://www.uize.com/license.html
*/
Uize.module({name:'Uize.Scruncher',required:['Uize.Xml','Uize.String','Uize.Data'],builder:function(){var _a=function(){},_b=true,_c=false;function _d(_e,_f){return Uize.Data.getLookup(_e.split(''),_f!=null?_f:_b);}function _g(_h){var _h=(_h+'').toUpperCase();return _h=='TRUE'||_h=='ON'||_h=='1';}var _i=0,_j=1,_k=2,_l=3,_m=4,_n=5,_o=6,_p=7,_q=_d('+-*/%&|^~<>=!?:',_o),_r=_d('.,()[]{};',_l),_s=_d('"\'',_m),_t=_d('\n\r',_p),_u=_d('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_$',_j),_v=_d('0123456789',_k),_w=Uize.copyInto(_v,{x:_k}),_x=Uize.copyInto({},_t,_q,_r,_s,_w,_u),_y=Uize.copyInto({},_u,_w),_z=_d(')]'),_A='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'.split(''),_B=_A.length,_C=/^(:|!+|\*|-|\+|\||\|\||&|&&|%|>|>>|<|<<|=|==|\?|\^)\/$/;var _D={};function _E(_F){Uize.copyInto(_D,typeof _F=='string'?Uize.Xml.fromAttributes(_F,{nameCase:'upper'}):_F);_D.LINECOMPACTING=_g(_D.LINECOMPACTING);_D.KEEPHEADCOMMENT=_g(_D.KEEPHEADCOMMENT);_D.AUDITSTRINGS=_g(_D.AUDITSTRINGS);_G=[];
var _H=_D.MAPPINGS.split(',');for(var _I= -1;++_I<_H.length;){var _J=Uize.String.splitInTwo(_H[_I],'=');_G[_I]=new _K(_J[0],_J[1]);}}function _K(_L,_M){this._L=_L;this._M=_M||_L;this._N=[];this._O=0;}_a.scrunch=function(_P,_F){var _Q=0,_R=0,_S=0,_T=0,_U=0,_V=0,_W=0,_X=_c,_Y=1,_Z=_0='',_1=[],_2={},_3=_c,_4,_5,_6='',_7,_8=_c,_9=_i,_ba='',_bb=_i,_bc='',_bd=_c,_be='',_bf='',_bg=Uize.String.startsWith;_D.LINECOMPACTING='TRUE';_D.MAXLINELENGTH=1024;_D.MAPPINGS='';_D.KEEPHEADCOMMENT='TRUE';_D.AUDITSTRINGS='FALSE';_E(_F);for(var _bh= -1,_bi=_P.length,_bj=_bi-1;++_bh<=_bi;){_7=_6;if(_bh>_bj){_6='';_bd=_b;}else{_6=_P.charAt(_bh);(_6=='\r'||(_6=='\n'&&_7!='\r'))&&_Y++;if(_9==_j){if(!_y[_6])_bd=_b;}else if(_9==_k){if(!_w[_6])_bd=_b;}else if(_9==_l){if(!_r[_6])_bd=_b;}else if(_9==_m){if(_8){_8=_c;}else if(_6=='\\'){_8=_b;}else if(_6==_5){if(_D.AUDITSTRINGS&&_5!='/'){var _bk=_bc.slice(1),_bl=_2[_bk];(_bl instanceof Array?_bl:(_2[_bk]=[])).push(_Y);}_bc+=_6;_6='';_bd=_b;}}else if(_9==_n){if(_4=='//'){
if(_6=='\n'||_6=='\r')_bd=_b;}else if(_4=='/*'){if(_bc.length>2&&_7+_6=='*/'){_bc+=_6;_bd=_b;_6='';}}}else if(_9==_o){if(_bc=='/'&&(_6=='/'||_6=='*')){_9=_n;_4=_bc+_6;var _bm;if(_6=='*'){_bm=_P.indexOf('*/',_bh+1);if(_bm<0)_bm=_bi;}else{var _bn=_P.indexOf('\n',_bh+1),_bo=_P.indexOf('\r',_bh+1);_bm=Math.min(_bn<0?_bi:_bn,_bo<0?_bi:_bo);}_bc=_P.slice(_bh-1,_bm-1);_6=_P.charAt(_bh=_bm-1);}else if(_bc=='/'&&(_bb!=_j||_ba=='return')&&_bb!=_k&&_bb!=_m&& !(_bb==_l&&_z[_ba.slice(-1)])){_9=_m;_5='/';_6='';_bh--;}else if(!_q[_6]||_C.test(_bc+_6)){_bd=_b;}}else if(_9==_p){if(_6!='\n'&&_6!='\r')_bd=_b;}_X=_X||(_9&&_9!=_n&&(_9!=_p||_bc.length>1));}if(_bd){if(_9==_j){for(var _bp= -1;++_bp<_G.length;){var _bq=_G[_bp];if(_bg(_bc,_bq._L+'_')){_R++;var _br=_bq._N[_bc]||'';if(!_br){_Q++;var _bs=_bq._O++;do{_br=_A[_bs-_B*(_bs=Math.floor(_bs/_B))]+_br;}while(_bs>0);_br=_bq._N[_bc]=_bq._M+'_'+_br;}_S+=_bc.length-(_bc=_br).length;break;}}}else if(_9==_n){_1.push(_bc);_U+=_bc.length;var _bt=_c;if(/^\/[\*\/]\s*scruncher/i.test(_bc)){
if(_bc.substr(2,17).toLowerCase()=='scrunchersettings'){_bt=_b;_E(_bc.slice(2,_bc.length-(_4=='/*')*2));_bc='';}else if(/^\/[\*\/]\s*scruncher:leave next comment/i.test(_bc)){_bt=_3=_b;_bc='';}}if(!_bt){if((_X|| !_D.KEEPHEADCOMMENT)&& !_3){_bc='';}else if(_4=='/*'){if(_3){if(_D.LINECOMPACTING)_bc='\n'+_bc+'\n';_3=_c;}_bc+='\n';}}if(!_bc)_W++;_U-=_bc.length;}else if(_9==_p){_V+=_bc.length;_bc='';if(!_D.LINECOMPACTING||(_be.length+_bf.length>_D.MAXLINELENGTH)){_Z+=_be+'\n';_V--;_be='';}_be+=_bf;_bf='';}if(((_9==_j||_9==_o)&&_bb==_9)||(_9==_k&&_v[_bc.charAt(0)]&&_bb==_j)){_bc=' '+_bc;_T--;}_bd=_c;if(_bc){_bf+=_bc;_ba=_bc;_bb=_9;}_bc='';_9=_i;}if(!_9&&_6){_9=_x[_6];if(_9==_m)_5=_6;}_9?(_bc+=_6):(_T+=_6.length);}return{scrunchedCode:_Z+=_be+_bf,comments:_1,stringsMap:_2,report:'Unique Identifiers Scrunched: '+_Q+'\n'+'Incidences of Identifiers Scrunched: '+_R+'\n'+'Savings From Scrunched Identifiers: '+_S+'\n'+'Savings From Removed Whitespace: '+_T+'\n'+'Total Comments Removed: '+_W+'\n'+
'Savings From Removed Comments: '+_U+'\n'+'Savings From Removed Linebreaks: '+_V+'\n'+'Supposed Total Savings: '+(_S+_T+_U+_V-_0.length)+'\n'+'Real Total Savings: '+(_P.length-_Z.length)+'\n\n'+'FINAL SIZE: '+_Z.length};};return _a;}});